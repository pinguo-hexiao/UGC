<!DOCTYPE html>
<html style="font-size: 50px">
  <head>
    <meta charset="utf-8">
    <title>yunle-template-gulp</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/base.css?rev=@@hash">
    <script type="text/javascript">
        (function (doc, win) {
            var docEl = doc.documentElement;
            var resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize';
            clientWidth = docEl.clientWidth;
            clientHeight = docEl.clientHeight;
            docEl.style.fontSize = ((100 * (clientWidth / 750)) >= 50 ? 50 : (100 * (clientWidth / 750))) + 'px';
            var recalc = function () {
                clientWidth = docEl.clientWidth;
                clientHeight = docEl.clientHeight;
                if (!clientWidth) return;
                docEl.style.fontSize = ((100 * (clientWidth / 750)) >= 50 ? 50 : (100 * (clientWidth / 750))) + 'px';
            };
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js"></script>
  </head>
  <body>
    <div id="wrap" class="infoWrap">
      <div id="heade">
        <div class="title">
          <div class="picWrap">
            <img src="/images/header.png" alt="" class="pic">
          </div>
          <div class="ugcInfo">
            <p class="p-title">
              Hi～Stephanie,
            </p>
            <p class="p-info">
              挑战新玩法，由你来决定。
            </p>
            <p class="p-footer">
              <i class="line"></i>camera360
            </p>
          </div>
        </div>
      </div>
      <div id="main">
        <div class="info-box">
          <h2 class="info-title js-info-title">你敢素颜自拍么？</h2>
          <p class="info-describe js-info-describe">你本来就很美，丢掉美颜相机，秀出最真实的自己！你敢应战么？</p>
          <p class="info-play js-info-play">视频挑战，我来决定排名</p>
          <p class="info-picUrl">
            <img class="info-pic js-info-picUrl" src="https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=2516614602,2816475662&fm=80&w=179&h=119&img.JPEG" alt="" />
          </p>
        </div>
        <form class="formWrap js-ugc-from">
          <div style="display:none;" class="formItem clearfix">
            <label for="">
              id
            </label>
            <div class="formIptWrap ipt-1 clearfix">
              <input name="id" type="text" class="ipt js-ugc-contact">
            </div>
          </div>
          <p class="info-getContact">
            这挑战真不错，感谢你的反馈，请留下你的联系方式，以便我们能够联系到你。
          </p>
          <div class="formItem clearfix">
            <label for="">
              手机或邮箱
            </label>
            <div class="formIptWrap ipt-1 clearfix">
              <input name="contact" type="text" class="ipt js-ugc-contact">
            </div>
          </div>
          <div class="formItem clearfix">
            <div class="formIptWrap clearfix">
              <button class="btn js-create-btn" type="button" name="button">创建</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div style="display:none;" class="gModal js-gModal">
      <div class="modalBG js-gModal-bg"></div>
      <div class="modalMan">
        <div class="modalTitle js-gModal-title">提示</div>
        <div class="modalBody js-gModal-body">
          提交成功!
        </div>
        <div class="footer">
          <button class="modalBtn js-gModal-clearBtn" type="button" name="button">取消</button>
          <button class="modalBtn js-gModal-okBtn" type="button" name="button">确定</button>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="/js/base.js?rev=@@hash"></script>
    <script type="text/javascript">
      $(function() {
        var postData = {
          id: '',
          contact: ''
        };
        var _ugc = new UgcJsSDK({
          host: '/task/ugc',
        });
        postData.id = _ugc.getID('id');
        _ugc.getUGC(postData, function(err, data) {
          if(!err) {
            renderInfo(data);
          }
        });
        // 挑战主题
        $(".js-ugc-contact").on('change blur focus keydown keyup', function() {
          var $that = $(this);
          var val = $that.val();
          postData.contact = val;
          hasData(postData)
        });
        // 提交表单
        var hasSubmit = false;
        $('.js-create-btn').click(function() {
          var $that = $(this);
          var err = hasData(postData);
          if (!err && !hasSubmit) {
          hasSubmit = true;
          $that.text = '正在努力提交中...';
          _ugc.putUGC(postData, function(err, msg) {
            hasSubmit = false;
            $that.text = '提交';
            if (!err) {
              console.log(msg);
            }
          });
          } else {
            console.log('请填写完整表单: ', err);
          }
        });
      });

      // 验证数据
      function hasData(postData) {
        var $btn = $('.js-create-btn');
        var err = null;
        var phone = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        var email = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if(!phone.test(postData.contact)){
          if (!email.test(postData.contact)) {
            err = '请输入正确手机号或者邮箱';
          }
        }
        if (!err) {
          $btn.addClass('on');
        } else {
          $btn.removeClass('on');
        }
        return err;
      }
      // 渲染
      function renderInfo(data) {
        var $infoTitle = $('.js-info-title'),
            $infoDescribe = $('.js-info-describe'),
            $infoPlay = $('.js-info-play'),
            $infoPicUrl = $('.js-info-picUrl');
        $infoTitle.text(data.title);
        $infoDescribe.text(data.describe);
        var playText = '';
        playText = (data.type == 1 ? '照片挑战,' : '视频挑战,');
        switch(data.play) {
          case 1:
          playText += '网友投票并排名';
          break;
          case 2:
          playText += '我来决定排名';
          break;
          case 3:
          playText += '不需要排名';
          break;
          case 4:
          playText += data.otherText;
          break;
          default:
           playText += null;
        }
        $infoPlay.text(playText);
        $infoPicUrl.src(data.title);
      }
    </script>
  </body>
</html>
